<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Impostor - Familiar</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .card {
            background: #16213e;
            border: 1px solid #0f3460;
            color: #e94560;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.2);
        }

        h2 { color: #fff; margin-bottom: 25px;}

        input {
            padding: 15px;
            font-size: 18px;
            width: 70%;
            margin-bottom: 10px;
            border-radius: 10px;
            border: none;
            text-align: center;
            background: #0f3460;
            color: white;
            outline: none;
        }

        ul { text-align: left; font-size: 1.2em; margin-bottom: 20px; color: #a2a8d3; padding-left: 0; list-style: none;}
        ul li { padding: 8px; border-bottom: 1px solid #0f3460; }

        button {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: transform 0.1s, background 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 0 #c0354a;
        }

        button:active { transform: translateY(4px); box-shadow: none; }
        button:hover { background-color: #ff5e78; }
        
        button.secondary { background-color: #0f3460; box-shadow: 0 4px 0 #0a2140; font-size: 1em; }
        
        .big-text { font-size: 2.5em; font-weight: bold; color: #fff; margin: 20px 0; animation: popIn 0.5s; }
        .red-text { color: #e94560; text-transform: uppercase; letter-spacing: 2px;}
        .category-text { font-size: 1.5em; color: #a2a8d3; }
        
        .timer { font-size: 8em; font-weight: bold; color: #f1c40f; text-shadow: 4px 4px #000; margin: 20px 0; }
        
        .start-player-box {
            background-color: #0f3460;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.4em;
            color: #fff;
            border: 1px solid #f1c40f;
        }

        .result-box {
            background-color: rgba(22, 33, 62, 0.98);
            padding: 40px;
            border-radius: 20px;
            animation: fadeIn 0.5s;
            border: 3px solid #e94560;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            z-index: 100;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .hidden { display: none; }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="setupScreen" class="card">
        <h1>üïµÔ∏è EL IMPOSTOR</h1>
        <p style="color:#a2a8d3;">Ingresa los nombres de los jugadores</p>
        <input type="text" id="playerName" placeholder="Nombre (ej. Abuelo)" onkeypress="handleEnter(event)">
        <button onclick="addPlayer()" class="secondary">Agregar (+)</button>
        
        <div style="max-height: 200px; overflow-y: auto; margin-top:15px;">
            <ul id="playerList"></ul>
        </div>

        <button onclick="startGameSetup()">¬°COMENZAR PARTIDA!</button>
    </div>

    <div id="distributeScreen" class="card hidden">
        <h2 id="instructionText">...</h2>
        
        <button id="revealBtn" onclick="revealRole()">VER MI ROL üëÅÔ∏è</button>
        
        <div id="secretArea" class="hidden">
            <p class="category-text" id="catDisplay"></p>
            <div class="big-text" id="wordDisplay"></div>
            <p style="font-size: 0.9em; margin-bottom: 20px; color: #a2a8d3;">Memor√≠zala y borra la pantalla.</p>
            <button onclick="nextPlayer()" style="background-color: #27ae60; box-shadow: 0 4px 0 #219150;">OK, LISTO üëç</button>
        </div>
    </div>

    <div id="gameScreen" class="hidden">
        <p class="category-text">Categor√≠a: <span id="finalCategory" style="color:#fff; font-weight:bold;"></span></p>
        
        <div id="timerArea">
            <div class="timer" id="timer">05:00</div>
            
            <div class="start-player-box">
                Empieza preguntando: <br><strong id="startPlayerDisplay" style="color: #f1c40f; font-size: 1.5em;"></strong>
            </div>

            <button onclick="showFinalResult()" class="secondary" style="margin-top: 50px; background:#c0392b; box-shadow: 0 4px 0 #922b21;">üîç REVELAR CULPABLE</button>
        </div>
    </div>

    <div id="resultArea" class="result-box hidden">
        <h2 style="color:white; margin-top:0;">El Impostor era:</h2>
        <div id="impostorNameDisplay" class="big-text" style="color:#e94560; font-size:3.5em; margin: 10px 0;"></div>
        <div style="font-size: 1.5em; color: #2ecc71; margin-bottom: 30px;">Palabra: <strong id="secretWordDisplay" style="color:white"></strong></div>
        <button onclick="location.reload()">üîÑ Jugar Otra Vez</button>
    </div>

    <script>
        // --- DATOS DEL JUEGO ---
        let players = [];
        const words = [
            { cat: "Lugar", word: "Escuela" }, { cat: "Lugar", word: "Playa" },
            { cat: "Lugar", word: "Hospital" }, { cat: "Lugar", word: "Cine" },
            { cat: "Lugar", word: "Iglesia" }, { cat: "Lugar", word: "Mercado" },
            { cat: "Lugar", word: "Parque" }, { cat: "Lugar", word: "Gimnasio" },
            { cat: "Comida", word: "Tacos" }, { cat: "Comida", word: "Pizza" },
            { cat: "Comida", word: "Huevo" }, { cat: "Comida", word: "Sopa" },
            { cat: "Comida", word: "Pastel" }, { cat: "Comida", word: "Helado" },
            { cat: "Objeto", word: "Escoba" }, { cat: "Objeto", word: "Celular" },
            { cat: "Objeto", word: "Cama" }, { cat: "Objeto", word: "Dinero" },
            { cat: "Objeto", word: "Llaves" }, { cat: "Objeto", word: "Reloj" },
            { cat: "Animal", word: "Perro" }, { cat: "Animal", word: "Gato" },
            { cat: "Animal", word: "Gallina" }, { cat: "Animal", word: "Rat√≥n" },
            { cat: "Animal", word: "Elefante" }, { cat: "Animal", word: "Caballo" }
        ];

        let currentPlayerIndex = 0;
        let impostorIndex = 0;
        let currentWordObj = {};
        let timerInterval;
        let startingPlayer = "";
        let availableVoices = [];

        // --- SISTEMA DE VOZ MEJORADO ---
        // Cargar voces disponibles
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
        }
        window.speechSynthesis.onvoiceschanged = loadVoices;

        function speak(text) {
            if ('speechSynthesis' in window) {
                // Cancelar habla anterior si existe
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                
                // Buscar la mejor voz en espa√±ol (Prioridad: Google > Microsoft > Cualquiera ES)
                const spanishVoice = availableVoices.find(voice => 
                    voice.lang.includes('es') && (voice.name.includes('Google') || voice.name.includes('Mexico'))
                ) || availableVoices.find(voice => voice.lang.includes('es'));

                if (spanishVoice) {
                    utterance.voice = spanishVoice;
                } else {
                    utterance.lang = 'es-MX';
                }

                utterance.rate = 0.9; // Velocidad un poco m√°s lenta para ser m√°s clara
                utterance.pitch = 1;  // Tono normal
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- FUNCIONES L√ìGICAS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function handleEnter(e) { if(e.key === 'Enter') addPlayer(); }

        function addPlayer() {
            const input = document.getElementById('playerName');
            const name = input.value.trim();
            if (name) {
                players.push(name);
                const li = document.createElement('li');
                li.innerHTML = `üë§ ${name}`;
                document.getElementById('playerList').appendChild(li);
                input.value = '';
                input.focus();
            }
        }

        function startGameSetup() {
            // Aseguramos que las voces est√©n cargadas antes de empezar
            if(availableVoices.length === 0) loadVoices();

            if (players.length < 3) {
                alert("M√≠nimo 3 jugadores.");
                return;
            }
            shuffleArray(players);
            currentWordObj = words[Math.floor(Math.random() * words.length)];
            impostorIndex = Math.floor(Math.random() * players.length);
            startingPlayer = players[Math.floor(Math.random() * players.length)];

            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('distributeScreen').classList.remove('hidden');
            
            updateDistributionScreen();
        }

        function updateDistributionScreen() {
            const name = players[currentPlayerIndex];
            const instruction = `Por favor, p√°sale el dispositivo a ${name}`;
            document.getElementById('instructionText').innerText = instruction;
            
            // EL JUEGO HABLA
            speak(instruction);

            document.getElementById('revealBtn').classList.remove('hidden');
            document.getElementById('secretArea').classList.add('hidden');
        }

        function revealRole() {
            document.getElementById('revealBtn').classList.add('hidden');
            document.getElementById('secretArea').classList.remove('hidden');

            const catDisplay = document.getElementById('catDisplay');
            const wordDisplay = document.getElementById('wordDisplay');

            if (currentPlayerIndex === impostorIndex) {
                catDisplay.innerText = `Categor√≠a: ${currentWordObj.cat}`;
                wordDisplay.innerHTML = "<span class='red-text'>ERES EL IMPOSTOR</span>";
            } else {
                catDisplay.innerText = `Categor√≠a: ${currentWordObj.cat}`;
                wordDisplay.innerText = currentWordObj.word;
            }
        }

        function nextPlayer() {
            currentPlayerIndex++;
            if (currentPlayerIndex < players.length) {
                updateDistributionScreen();
            } else {
                startGame();
            }
        }

        function startGame() {
            document.getElementById('distributeScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            document.getElementById('finalCategory').innerText = currentWordObj.cat;
            document.getElementById('startPlayerDisplay').innerText = startingPlayer;
            
            speak("Todos saben su rol. Empieza preguntando... " + startingPlayer);

            let duration = 60 * 5; 
            const display = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                let minutes = parseInt(duration / 60, 10);
                let seconds = parseInt(duration % 60, 10);
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                display.textContent = minutes + ":" + seconds;

                // Avisos de voz
                if (duration === 60) speak("Queda un minuto");
                if (duration === 10) speak("Diez segundos");

                if (--duration < 0) {
                    clearInterval(timerInterval);
                    display.textContent = "¬°TIEMPO!";
                    display.style.color = "#e74c3c";
                    speak("¬°Tiempo terminado! Se√±alen al impostor.");
                }
            }, 1000);
        }

        function showFinalResult() {
            clearInterval(timerInterval);
            document.getElementById('resultArea').classList.remove('hidden');
            const imposterName = players[impostorIndex];
            
            document.getElementById('impostorNameDisplay').innerText = imposterName;
            document.getElementById('secretWordDisplay').innerText = currentWordObj.word;
            
            speak(`El impostor era... ${impostorName}. La palabra era... ${currentWordObj.word}`);
        }
    </script>
</body>
</html>