<!DOCTYPE html>
<html lang="es">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5652456417162006"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Impostor</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: white; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 10px;}
        
        /* Estilos Generales */
        .card { background: #16213e; padding: 30px; border-radius: 20px; box-shadow: 0 0 20px rgba(233, 69, 96, 0.2); width: 90%; max-width: 500px; margin-bottom: 20px; border: 1px solid #0f3460; }
        .hidden { display: none !important; }
        
        button { background: #e94560; color: white; border: none; padding: 15px 30px; font-size: 1.2em; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; }
        button:hover { background: #ff5e78; }
        input { padding: 15px; width: 80%; border-radius: 10px; border: none; text-align: center; font-size: 1.2em; margin-bottom: 10px; background: #0f3460; color: white; }

        /* Estilos EspecÃ­ficos TV (HOST) */
        #hostView h1 { color: #f1c40f; font-size: 3em; margin: 0;}
        #qrCode { background: white; padding: 10px; border-radius: 10px; display: inline-block; margin: 20px 0; }
        .player-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
        .player-badge { background: #3498db; padding: 10px 20px; border-radius: 20px; font-weight: bold; animation: popIn 0.3s; }
        
        /* Estilos EspecÃ­ficos Celular (PLAYER) */
        .role-card { padding: 20px; border-radius: 15px; margin-top: 20px; border: 2px solid white; }
        .impostor { background: #c0392b; }
        .citizen { background: #27ae60; }
        .big-word { font-size: 3em; font-weight: bold; margin: 20px 0; text-transform: uppercase; }

        @keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }
    </style>
</head>
<body>

    <div id="modeSelect" class="card">
        <h2>Â¿QuÃ© pantalla es esta?</h2>
        <button onclick="initHost()">ðŸ“º SOY LA TV (HOST)</button>
        <button onclick="initPlayer()">ðŸ“± SOY JUGADOR</button>
    </div>

    <div id="hostView" class="hidden">
        <h1>Â¡EL IMPOSTOR!</h1>
        <p>Escanea para unirte:</p>
        <div id="qrCode"></div>
        <h2 style="margin-top:0">Jugadores: <span id="count">0</span></h2>
        
        <div id="playerList" class="player-grid"></div>
        
        <div style="width: 100%; max-width: 400px; margin-top: 30px;">
            <button onclick="startGame()" id="btnStart" style="font-size: 2em;">COMENZAR JUEGO</button>
        </div>

        <div id="hostGameScreen" class="hidden" style="margin-top:30px;">
            <h2 style="color:#a2a8d3">CategorÃ­a: <span id="hostCategory" style="color:white"></span></h2>
            <div style="background:#0f3460; padding:20px; border-radius:15px; border: 1px solid #f1c40f;">
                Empieza preguntando:<br>
                <strong id="hostStarter" style="color:#f1c40f; font-size:2em;">...</strong>
            </div>
            <div id="timer" style="font-size: 5em; font-weight: bold; color:#e94560; margin-top:20px;">05:00</div>
            <button onclick="resetGame()" style="background:#3498db; margin-top:30px;">Reiniciar Todo</button>
        </div>
    </div>

    <div id="playerView" class="hidden" style="width: 100%;">
        
        <div id="loginScreen" class="card">
            <h2>Tu Nombre</h2>
            <input type="text" id="username" placeholder="Ej. Alex">
            <button onclick="joinGame()">ENTRAR</button>
        </div>

        <div id="waitingScreen" class="card hidden">
            <h2>Â¡EstÃ¡s dentro!</h2>
            <p>Mira la TV...</p>
            <div style="font-size: 3em;">ðŸ‘€</div>
        </div>

        <div id="roleScreen" class="card hidden">
            <h3 id="roleTitle">TU ROL:</h3>
            <div id="roleCardBox" class="role-card">
                <div id="secretWord" class="big-word">...</div>
                <p id="roleDesc"></p>
            </div>
            <p style="color:#a2a8d3; margin-top:20px;">CategorÃ­a: <span id="playerCategory"></span></p>
        </div>
    </div>

    <script>
        const socket = io();
        let isHost = false;

        // --- LÃ“GICA DE INICIO ---
        function initHost() {
            isHost = true;
            document.getElementById('modeSelect').classList.add('hidden');
            document.getElementById('hostView').classList.remove('hidden');
            
            // Generar QR con la URL actual
            new QRCode(document.getElementById("qrCode"), {
                text: window.location.href,
                width: 200,
                height: 200
            });
        }

        function initPlayer() {
            document.getElementById('modeSelect').classList.add('hidden');
            document.getElementById('playerView').classList.remove('hidden');
        }

        // --- LÃ“GICA DEL JUGADOR ---
        function joinGame() {
            const name = document.getElementById('username').value;
            if(name) {
                socket.emit('joinGame', name);
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('waitingScreen').classList.remove('hidden');
            }
        }

        socket.on('roleAssign', (data) => {
            document.getElementById('waitingScreen').classList.add('hidden');
            document.getElementById('roleScreen').classList.remove('hidden');
            
            const card = document.getElementById('roleCardBox');
            const word = document.getElementById('secretWord');
            const desc = document.getElementById('roleDesc');
            const cat = document.getElementById('playerCategory');

            cat.innerText = data.category;

            if (data.role === 'Impostor') {
                card.className = 'role-card impostor';
                word.innerText = "IMPOSTOR";
                desc.innerText = "No sabes la palabra. Â¡EngÃ¡Ã±alos!";
            } else {
                card.className = 'role-card citizen';
                word.innerText = data.word;
                desc.innerText = "Eres un ciudadano. Descubre al mentiroso.";
            }
        });

        socket.on('resetClient', () => {
            if(!isHost) {
                document.getElementById('roleScreen').classList.add('hidden');
                document.getElementById('waitingScreen').classList.remove('hidden');
            }
        });

        // --- LÃ“GICA DEL HOST (TV) ---
        socket.on('updatePlayerList', (players) => {
            if(!isHost) return;
            const list = document.getElementById('playerList');
            document.getElementById('count').innerText = players.length;
            list.innerHTML = players.map(p => `<div class="player-badge">${p.name}</div>`).join('');
        });

        function startGame() {
            socket.emit('startGame');
        }

        socket.on('gameStartedMain', (data) => {
            if(!isHost) return;
            document.getElementById('btnStart').parentElement.classList.add('hidden'); // Ocultar botÃ³n start
            document.getElementById('qrCode').classList.add('hidden'); // Ocultar QR
            document.getElementById('hostGameScreen').classList.remove('hidden');
            
            document.getElementById('hostCategory').innerText = data.category;
            document.getElementById('hostStarter').innerText = data.start;

            // Timer simple
            let duration = 300;
            const timerDisplay = document.getElementById('timer');
            const interval = setInterval(() => {
                let m = Math.floor(duration / 60);
                let s = duration % 60;
                timerDisplay.innerText = `0${m}:${s<10?'0':''}${s}`;
                if(--duration < 0) clearInterval(interval);
            }, 1000);
        });

        function resetGame() {
            socket.emit('resetGame');
            location.reload(); // Recarga simple para el host
        }

    </script>
</body>
</html>